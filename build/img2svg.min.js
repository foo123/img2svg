/**
*
*   img2svg.js
*   @version: 2.0.0
*   @built on 2024-11-13 12:06:13
*
*   Vectorize image data based on multilabel-potrace algorithm with color
*   https://github.com/foo123/img2svg.js
*
**/!function(t,r,e){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[r]=e.call(t)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(r)?define(r,["module"],function(r){return e.moduleUri=r.uri,e.call(t)}):r in t||(t[r]=e.call(t)||1)&&"function"==typeof define&&define.amd&&define(function(){return t[r]})}("undefined"!=typeof self?self:this,"img2svg",function(){"use strict";function r(r,t){return i.trace(r.data,r.width,r.height,t||{})}r.VERSION="2.0.0";(O={MULTILABEL_POTRACE_VERSION:"2020",POTRACE_VERSION:"1.16",defaultOptions:function(){return{outline:0,depth:16,transparency:50,layered:!1,minpathsegments:0,turdsize:0,linetolerance:.5,alphamax:1,opttolerance:.2}}}).trace=function(r,t,e,n){(n=function(r,t){for(var e in t)C.call(t,e)&&!C.call(r,e)&&(r[e]=t[e]);return r}(n||{},O.defaultOptions())).depth=T(n.depth||0,2,256),n.transparency=T(n.transparency||0,0,100),n.layered=!!n.layered,n.minpathsegments=T(n.minpathsegments||0,0,k),n.turdsize=T(n.turdsize||0,0,k),n.linetolerance=T(n.linetolerance||0,0,10),n.linetolerance<.5&&(n.linetolerance=0),n.alphamax=T(n.alphamax||0,0,10),n.opttolerance=T(n.opttolerance||0,0,10);r=function(y,h,x,d,p,m,_,t,r){var e,n,o,i,a,s,c,u,f,l,g,v,w,b,A,M,S,R,E,O,C=h*x;function k(){var n=z.ceil(255/(T(d||0,2,256)-1)),o=z.ceil(255/(T(p||0,2,256)-1)),i=z.ceil(255/(T(m||0,2,256)-1));function r(r){var t,e,r=r<<2;return _>=y[3+r]?-1:(t=z.round(y[r]/n)*n,e=z.round(y[1+r]/o)*o,r=z.round(y[2+r]/i)*i,((0|T(t,0,255))<<16)+((0|T(e,0,255))<<8)+(0|T(r,0,255)))}function e(r){for(;r!==r.root;)r=r.root;return r}function t(r,t){(r=e(r))!==(t=e(t))&&(r.root=t)}for(var a,s,c,u,f=new Array(C),l=0;l<C;++l)f[l]=r(l);for((E=new Array(C))[0]=new q(0,0),c=s=0,a=1;a<h;++a)E[a]=f[a]===f[a-1]?E[a-1]:new q(a,0);for(c=(s=1)*h;s<x;++s,c+=h)for(E[c]=f[c]===f[c-h]?E[c-h]:new q(0,s),a=1;a<h;++a)u=f[a+c]===f[a-1+c]?E[a-1+c]:null,f[a+c]===f[a-1+c-h]&&(null!=u?t(u,E[a-1+c-h]):u=E[a-1+c-h]),f[a+c]===f[a+c-h]&&(null!=u?t(u,E[a+c-h]):u=E[a+c-h]),E[a+c]=null!=u?u:new q(a,s),f[a-1+c]===f[a+c-h]&&t(E[a-1+c],E[a+c-h]);for(a=s=l=R=0;l<C;++l,++a)h<=a&&(a=0,++s),(u=e(E[l])).id<0&&(u.id=R++,u.color=f[l]),++u.area,nr(u,a,s),E[l]=u;for(O=new Array(R),l=0;l<C;++l)O[E[l].id]=E[l]}if(C<=t)R=1,(S=new q(0,0)).id=0,S.color=-1,S.cover=S.area=C,S.xm=0,S.xM=h-1,S.ym=0,S.yM=x-1,r&&(S.surround=[]),E=new Array(C).fill(S),O=[S];else{if(k(),0<t)do{for(f=l=g=a=i=0;g<C;++g,++f)if(h<=f&&(f=0,++l),!((b=E[g]).area>t||b.area<=0)){for(i=1,v=h*z.max(l-2,0),w=z.max(f-2,0),A=h*z.min(l+2,x-1),M=z.min(f+2,h-1),s=0,c=null,u={},o=A,e=w,n=M;v<=o&&!(n<e&&(e=w,n=M,(o-=h)<v));++e,--n)S=E[n+o],b.id!==S.id&&S.area>t&&(u[S.id]=(u[S.id]||0)+1,u[S.id]>=s)&&(s=u[S.id],c=S),e<n&&(S=E[e+o],b.id!==S.id)&&S.area>t&&(u[S.id]=(u[S.id]||0)+1,u[S.id]>=s)&&(s=u[S.id],c=S);c&&(--b.area,++c.area,nr(c,f,l),E[g]=c,a=1)}}while(i&&a);R=0,O=O.filter(function(r){return t<r.area&&(r.cover=(r.yM-r.ym+1)*(r.xM-r.xm+1),!0)}).map(function(r,t){return[r,t]}).sort(function(r,t){return t[0].cover===r[0].cover?r[1]-t[1]:t[0].cover-r[0].cover}).map(function(r){return(r=r[0]).id=R++,r}),r&&!function(){for(var r=0,t=0,e=0,n=null;r<C;++r,++e)h<=e&&(e=0,t+=h),null==(n=E[r]).surround&&(n.surround=[]),0<e&&n.id!==E[e-1+t].id&&F(n.surround,E[e-1+t]),0<t&&n.id!==E[e+t-h].id&&F(n.surround,E[e+t-h]),0<e&&0<t&&n.id!==E[e-1+t-h].id&&F(n.surround,E[e-1+t-h]),e+1<h&&n.id!==E[e+1+t].id&&F(n.surround,E[e+1+t]),t+h<C&&n.id!==E[e+t+h].id&&F(n.surround,E[e+t+h]),e+1<h&&t+h<C&&n.id!==E[e+1+t+h].id&&F(n.surround,E[e+1+t+h]),0<e&&t+h<C&&n.id!==E[e-1+t+h].id&&F(n.surround,E[e-1+t+h]),e+1<h&&0<t&&n.id!==E[e+1+t-h].id&&F(n.surround,E[e+1+t-h])}()}for(g=0;g<R;++g)O[g].color=-1!==O[g].color&&function(r,t){var e=r>>>16&255,n=r>>>8&255,r=255&r;return"rgb"===t?"rgb("+e.toString()+","+n.toString()+","+r.toString()+")":(e=e.toString(16),n=n.toString(16),r=r.toString(16),e.length<2&&(e="0"+e),n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),e.charAt(0)===e.charAt(1)&&n.charAt(0)===n.charAt(1)&&r.charAt(0)===r.charAt(1)?"#"+e.charAt(1)+n.charAt(1)+r.charAt(1):"#"+e+n+r)}(O[g].color,"hex");return{width:h,height:x,components:R,component:O,data:E,bboxes:null,border_statuses:null,raw_contours:null,simplified_contours:null,smoothed_contours:null}}(r,t,e,n.depthR||n.depth,n.depthG||n.depth,n.depthB||n.depth,255*n.transparency/100,n.turdsize,n.layered);if(1<r.components){var o=r,i=n,a=o,s=(i.layered,a);s.bboxes=s.component.reduce(function(r,t){return r[t.id]={lower_left:new I(t.xm,s.height-1-t.yM),upper_right:new I(t.xM+1,s.height-1-t.ym+1)},r},new Array(s.components)),a.border_statuses=new Array(a.data.length).fill(0),a.raw_contours=new Array(a.components);for(var c=0,u=a.components;c<u;++c)a.raw_contours[c]=function(r,t){var e=0,n=[],o=r.bboxes[t].lower_left.copy(),i=fr(r,t,o);for(;i!==N;)++e,n.push(function(r,t,e){var n,o=0,i=[],a=t.copy(),s=[e],c=!1;for(;c=function(r,t,e,n,o){var i,a=e[0],s=U(r,t.x,t.y),c=k;0===a?(i=r.data[s-1].id,o.other_comp=t.x>r.width-1?c:r.data[s].id):a===N?(i=r.data[G(r,s)].id,o.other_comp=t.x<=0?c:r.data[B(r,s)].id):2===a?(i=r.data[B(r,s)].id,o.other_comp=t.y>r.height-1?c:r.data[s-1].id):(i=r.data[s].id,o.other_comp=t.y<=0?c:r.data[G(r,s)].id);var u=0;o.segments=[],i>o.other_comp&&o.segments.push(t.copy());var f,l,y=!1,h=!0;for(;;){if(i<o.other_comp&&(o.segments.length>u?o.segments[u]=t.copy():o.segments.push(t.copy()),++u),y||V(t,n)&&!h)break;$(r,t,a)&&!function(r,t,e){r.border_statuses[ur(r,t,e)]|=1<<e}(r,s,a),0===a?(t.y++,s=ar(r,s),t.y>r.height-1?f=l=c:(f=r.data[s-1].id,l=t.x>r.width-1?c:r.data[s].id)):a===N?(t.y--,s=function(r,t){return t+=r.width}(r,s),t.y<=0?f=l=c:(f=r.data[G(r,s)].id,l=t.x<=0?c:r.data[B(r,s)].id)):2===a?(t.x--,s=function(r){return--r}(s),t.x<=0?f=l=c:(f=r.data[B(r,s)].id,l=t.y>r.height-1?c:r.data[s-1].id)):(t.x++,s=sr(0,s),t.x>r.width-1?f=l=c:(f=r.data[s].id,l=t.y<=0?c:r.data[G(r,s)].id)),h&&(i>o.other_comp&&o.segments.push(t.copy()),h=!1),f===i?l===i?a=P(a):l!==o.other_comp&&(y=!0):f===o.other_comp?a=(l===i&&i===function(r,t,e,n){var o=3;o>r.width&&(o=r.width);o>r.height&&(o=r.height);var i=0,a=0,s=o*o,c=t.x>o?t.x-o:0,u=t.x<r.width-o?t.x+o:r.width-1,f=t.y>o?t.y-o:0,l=t.y<r.height-o?t.y+o:r.height-1;a=i=0;for(var y=c;y<u;++y)for(var h=U(r,y,f),x=f;x<l;++x){var d=y+.5-t.x,p=x+.5-t.y;d*d+p*p<s&&(r.data[h].id===e?++i:r.data[h].id===n&&++a),h=ar(r,h)}{if(i<a)return e;if(a<i)return n}{if(i=(r.bboxes[e].upper_right.x-r.bboxes[e].lower_left.x)*(r.bboxes[e].upper_right.y-r.bboxes[e].lower_left.y),a=(r.bboxes[n].upper_right.x-r.bboxes[n].lower_left.x)*(r.bboxes[n].upper_right.y-r.bboxes[n].lower_left.y),i<a)return e;if(a<i)return n}return e<n?e:n}(r,t,i,o.other_comp)?P:cr)(a):l===i?a=P(a):(a=cr(a),y=!0)}i<o.other_comp?o.length=u-1:o.length=0;return e[0]=a,y}(r,t,s,a,n={length:0,segments:null,other_comp:k,others:null}),i.push(n),++o,!V(t,a););if(1<o&&!c){var u=i[0],f=i[--o];if(u.length){for(var l=1,y=u.length;l<=y;++l)f.segments.push(u.segments[l]);f.others&&f.others.push.apply(f.others,u.others.filter(function(r){return-1===f.others.indexOf(r)})),u.length+=f.length}u.segments=f.segments,u.others=f.others,f.others=f.segments=null}return{number_of_paths:o,paths:i}}(r,o.copy(),i)),i=fr(r,t,o);return{number_of_borders:e,borders:n}}(a,c);if(o.simplified_contours=null,o.smoothed_contours=null,i.linetolerance){i.alphamax?o.smoothed_contours=or(o.raw_contours):o.simplified_contours=or(o.raw_contours);for(var f=o.components,l=0;l<f;++l)for(var y=o.raw_contours[l],h=0,x=y.number_of_borders;h<x;++h)for(var d=y.borders[h],p=0,m=d.number_of_paths;p<m;++p)!function(r,t,e,n,o){var i=r.raw_contours[t].borders[e].paths[n];if(!(t>i.other_comp)){var a=new yr,s=i.length,c=i.segments,i=V(c[0],c[c.length-1]);a.len=i?s:s+1,a.pt=new Array(a.len);for(var u=0,f=a.len;u<f;++u)a.pt[u]=new I(T(c[u].x,0,r.width-1),T(c[u].y,0,r.height-1));!function(r,t,e){(function(r){var t,e,n,o=r.pt,i=(r.x0=o[0].x,r.y0=o[0].y,r.sums=[],r.sums);for(i.push(new D(0,0,0,0,0)),t=0;t<r.len;++t)e=o[t].x-r.x0,n=o[t].y-r.y0,i.push(new D(i[t].x+e,i[t].y+n,i[t].xy+e*n,i[t].x2+e*e,i[t].y2+n*n))})(r),function(r,t,e){var n,o,i,a,s,c,u,f,l,y=r.len,h=r.pt,x=new Array(y),d=new Array(y),p=new Array(4),m=[new I(0,0),new I(0,0)],_=new I(0,0),g=new I(0,0),v=new I(0,0),w=e?0:y-1;for(r.lon=new Array(y),i=y-1;0<=i;--i)h[i].x!==h[w].x&&h[i].y!==h[w].y&&(w=i+1),d[i]=w;for(i=y-1;0<=i;--i)if(e||i!==y-1){for(p[0]=p[1]=p[2]=p[3]=0,n=3+3*(h[K(i+1,y,e)].x-h[i].x)+(h[K(i+1,y,e)].y-h[i].y)>>>1,++p[n],m[0].x=0,m[0].y=0,m[1].x=0,m[1].y=0,w=d[i],s=i;;){if(o=0,n=3+3*W(h[w].x-h[s].x)+W(h[w].y-h[s].y)>>>1,++p[n],p[0]&&p[1]&&p[2]&&p[3]){x[i]=s,o=1;break}if(_.x=h[w].x-h[i].x,_.y=h[w].y-h[i].y,Q(m[0],_)<0||0<Q(m[1],_))break;if(z.abs(_.x)<=t&&z.abs(_.y)<=t||(g.x=_.x+(0<=_.y&&(0<_.y||_.x<0)?t:-t),g.y=_.y+(_.x<=0&&(_.x<0||_.y<0)?t:-t),0<=Q(m[0],g)&&(m[0].x=g.x,m[0].y=g.y),g.x=_.x+(_.y<=0&&(_.y<0||_.x<0)?t:-t),g.y=_.y+(0<=_.x&&(0<_.x||_.y<0)?t:-t),Q(m[1],g)<=0&&(m[1].x=g.x,m[1].y=g.y)),s=w,!e&&s===y-1){x[i]=s,o=1;break}if(!hr(w=d[s],i,s))break}0===o&&(v.x=W(h[w].x-h[s].x),v.y=W(h[w].y-h[s].y),_.x=h[s].x-h[i].x,_.y=h[s].y-h[i].y,c=Q(m[0],_),u=Q(m[0],v),f=Q(m[1],_),l=Q(m[1],v),a=k,u<0&&(a=z.floor(c/-u)),0<l&&(a=z.min(a,z.floor(-f/l))),x[i]=K(s+a,y,e))}else x[i]=y-1;for(a=x[y-1],r.lon[y-1]=a,i=y-2;0<=i;--i)hr(i+1,x[i],a)&&(a=x[i]),r.lon[i]=a;if(e)for(i=y-1;hr(J(i+1,y),a,r.lon[i]);--i)r.lon[i]=a}(r,t.linetolerance,e),function(r,t){var e,n,o,i,a,s,c,u=r.len,f=new Array(u+1),l=new Array(u+1),y=new Array(u),h=new Array(u+1),x=new Array(u+1),d=new Array(u+1);for(e=0;e<u;++e)t?((c=J(r.lon[J(e-1,u)]-1,u))==e&&(c=J(e+1,u)),y[e]=c<e?u:c):((c=0===e?r.lon[e]-1:r.lon[e-1]-1)===e&&(c=e+1),y[e]=u-2<=c?u:c);for(n=1,e=0;e<u;++e)for(;n<=y[e];)h[n]=e,n++;for(n=e=0;e<u;++n)x[n]=e,e=y[e];for(x[n]=u,e=u,n=o=n;0<n;--n)d[n]=e,e=h[e];for(d[0]=0,f[0]=0,n=1;n<=o;++n)for(e=d[n];e<=x[n];++e){for(s=-1,i=x[n-1];i>=h[e];--i)a=function(r,t,e){var n,o,i,a,s,c,u=r.len,f=r.pt,r=r.sums,l=0;u<=e&&(e-=u,l=1);l=0===l?(n=r[e+1].x-r[t].x,o=r[e+1].y-r[t].y,a=r[e+1].x2-r[t].x2,i=r[e+1].xy-r[t].xy,s=r[e+1].y2-r[t].y2,e+1-t):(n=r[e+1].x-r[t].x+r[u].x,o=r[e+1].y-r[t].y+r[u].y,a=r[e+1].x2-r[t].x2+r[u].x2,i=r[e+1].xy-r[t].xy+r[u].xy,s=r[e+1].y2-r[t].y2+r[u].y2,e+1-t+u);return r=(f[t].x+f[e].x)/2-f[0].x,u=(f[t].y+f[e].y)/2-f[0].y,c=f[e].x-f[t].x,e=-(f[e].y-f[t].y),f=e*e*((a-2*n*r)/l+r*r)+2*e*c*((i-n*u-o*r)/l+r*u)+c*c*((s-2*o*u)/l+u*u),z.sqrt(f)}(r,i,e)+f[i],(s<0||a<s)&&(l[e]=i,s=a);f[e]=s}for(r.m=t?o:o+1,r.po=new Array(r.m),e=u,n=o-1;0<e;--n)e=l[e],r.po[n]=e;t||(r.po[o]=r.len-1)}(r,e),function(r,t){var e,n,o,i,a,s,c,u,f,l,y,h,x,d,p,m=r.m,_=r.po,g=r.len,v=r.pt,w=r.x0,b=r.y0,A=new Array(m),M=new Array(m),S=new Array(m),R=new Array(3),E=t?m:m-1,O=new I(0,0);for(r.curve=new j(m),n=0;n<E;++n)o=t?(o=_[J(n+1,m)],J(o-_[n],g)+_[n]):_[n+1],A[n]=new I(0,0),M[n]=new I(0,0),!function(r,t,e,n,o,i){var a,s,c,u,f,l,y=r.len,h=r.sums,x=0;for(;y<=e;)e-=y,x+=1;for(;y<=t;)t-=y,--x;for(;e<0;)e+=y,--x;for(;t<0;)t+=y,x+=1;a=h[e+1].x-h[t].x+x*h[y].x,s=h[e+1].y-h[t].y+x*h[y].y,u=h[e+1].x2-h[t].x2+x*h[y].x2,f=h[e+1].xy-h[t].xy+x*h[y].xy,h=h[e+1].y2-h[t].y2+x*h[y].y2,c=e+1-t+x*y,0===t?(n.x=r.pt[t].x-r.x0,n.y=r.pt[t].y-r.y0):0===e||!i&&e===y-1?(n.x=r.pt[e].x-r.x0,n.y=r.pt[e].y-r.y0):(n.x=a/c,n.y=s/c);i=(u-2*a*n.x)/c+n.x*n.x,r=(f-a*n.y-s*n.x)/c+n.x*n.y,u=(h-2*s*n.y)/c+n.y*n.y,f=(i+u+z.sqrt((i-u)*(i-u)+4*r*r))/2,i-=f,u-=f,z.abs(i)>=z.abs(u)?0!==(l=dr(i,r))&&(o.x=-r/l,o.y=i/l):0!==(l=dr(u,r))&&(o.x=-u/l,o.y=r/l);0===l&&(o.x=o.y=0)}(r,_[n],o,A[n],M[n],t);for(n=0;n<E;++n)if(S[n]=new X,0===(e=M[n].x*M[n].x+M[n].y*M[n].y))for(o=0;o<3;++o)for(i=0;i<3;++i)S[n].data[3*o+i]=0;else for(R[0]=M[n].y,R[1]=-M[n].x,R[2]=-R[1]*A[n].y-R[0]*A[n].x,a=0;a<3;++a)for(i=0;i<3;++i)S[n].data[3*a+i]=R[a]*R[i]/e;for(n=0;n<m;++n)if(t||0!==n&&n!==m-1){for(s=new X,c=new I(0,0),O.x=v[_[n]].x-w,O.y=v[_[n]].y-b,o=K(n-1,m,t),a=0;a<3;++a)for(i=0;i<3;++i)s.data[3*a+i]=S[o].at(a,i)+S[n].at(a,i);for(;;){if(0!=(l=s.at(0,0)*s.at(1,1)-s.at(0,1)*s.at(1,0))){c.x=(-s.at(0,2)*s.at(1,1)+s.at(1,2)*s.at(0,1))/l,c.y=(s.at(0,2)*s.at(1,0)-s.at(1,2)*s.at(0,0))/l;break}for(s.at(0,0)>s.at(1,1)?(R[0]=-s.at(0,1),R[1]=s.at(0,0)):s.at(1,1)?(R[0]=-s.at(1,1),R[1]=s.at(1,0)):(R[0]=1,R[1]=0),e=R[0]*R[0]+R[1]*R[1],R[2]=-R[1]*O.y-R[0]*O.x,a=0;a<3;++a)for(i=0;i<3;++i)s.data[3*a+i]+=R[a]*R[i]/e}if(u=z.abs(c.x-O.x),f=z.abs(c.y-O.y),u<=.5&&f<=.5)r.curve.vertex[n]=new I(c.x+w,c.y+b);else{if(y=Y(s,O),x=O.x,d=O.y,0!==s.at(0,0))for(p=0;p<2;++p)c.y=O.y-.5+p,c.x=-(s.at(0,1)*c.y+s.at(0,2))/s.at(0,0),u=z.abs(c.x-O.x),h=Y(s,c),u<=.5&&h<y&&(y=h,x=c.x,d=c.y);if(0!==s.at(1,1))for(p=0;p<2;++p)c.x=O.x-.5+p,c.y=-(s.at(1,0)*c.x+s.at(1,2))/s.at(1,1),f=z.abs(c.y-O.y),h=Y(s,c),f<=.5&&h<y&&(y=h,x=c.x,d=c.y);for(a=0;a<2;++a)for(i=0;i<2;++i)c.x=O.x-.5+a,c.y=O.y-.5+i,(h=Y(s,c))<y&&(y=h,x=c.x,d=c.y);r.curve.vertex[n]=new I(x+w,d+b)}}else r.curve.vertex[n]=v[_[n]].copy()}(r,e),"-"===r.sign&&function(r){var t,e,n,r=r.curve,o=r.n,i=r.vertex;for(t=0,e=o-1;t<e;++t,--e)n=i[t],i[t]=i[e],i[e]=n}(r);t.alphamax&&(function(r,t,e){var n,o,i,a,s,c,u=r.curve.n,f=e?u:u-2,l=r.curve;for(n=0;n<f;++n)o=K(n+1,u,e),s=K(n+2,u,e),c=Z(.5,l.vertex[s],l.vertex[o]),0!==(a=function(r,t){var e=function(r,t){return new I(-W(t.y-r.y),W(t.x-r.x))}(r,t);return e.y*(t.x-r.x)-e.x*(t.y-r.y)}(l.vertex[n],l.vertex[s]))?(a=rr(l.vertex[n],l.vertex[o],l.vertex[s])/a,a=z.abs(a),i=1<a?1-1/a:0,i/=.75):i=4/3,l.alpha0[o]=i,t<=i?(l.tag[o]="CORNER",l.c[3*o+1]=l.vertex[o]):(i<.55?i=.55:1<i&&(i=1),a=Z(.5+.5*i,l.vertex[n],l.vertex[o]),s=Z(.5+.5*i,l.vertex[s],l.vertex[o]),l.tag[o]="CURVETO",l.c[3*o+0]=a,l.c[3*o+1]=s),l.c[3*o+2]=c,l.alpha[o]=i,l.beta[o]=.5;e||(l.tag[0]="CORNER",l.c[1]=l.vertex[0],l.c[2]=Z(.5,l.vertex[1],l.vertex[0]),l.tag[u-1]="CORNER",l.c[3*(u-1)+1]=l.vertex[u-1])}(r,t.alphamax,e),t.opttolerance)&&!function(r,t,e){var n,o,i,a,s,c,u,f,l,y,h=r.curve,x=h.n,d=h.vertex,p=new Array(x+1),m=new Array(x+1),_=new Array(x+1),g=new Array(x+1),v=new H,w=e?x:x-1,b=new Array(x),A=new Array(x+1);for(o=0;o<w;++o)"CURVETO"===h.tag[o]?b[o]=W(rr(d[K(o-1,x,e)],d[o],d[K(o+1,x,e)])):b[o]=0;for(A[c=0]=0,a=h.vertex[0],o=0;o<w;++o)s=K(o+1,x,e),"CURVETO"===h.tag[s]&&(u=h.alpha[s],c=(c+=.3*u*(4-u)*rr(h.c[3*o+2],d[s],h.c[3*s+2])/2)+rr(a,h.c[3*o+2],h.c[3*s+2])/2),A[o+1]=c;for(p[0]=-1,m[0]=0,_[0]=0,i=1;i<=x;++i)if(p[i]=i-1,m[i]=m[i-1],_[i]=_[i-1]+1,!(x-1<=i))for(o=i-2;0<=o&&!function(r,t,e,n,o,i,a,s){var c,u,f,l,y,h,x,d,p,m,_,g,v,w,b,A,M,S=r.curve.n,R=r.curve,E=R.vertex;if(t===e)return 1;if(y=K((c=t)+1,S,s),u=K(c+1,S,s),0===(l=i[u]))return 1;for(h=er(E[t],E[y]),c=u;c!==e;c=u){if(u=K(c+1,S,s),f=K(c+2,S,s),i[u]!==l)return 1;if(W(tr(E[t],E[y],E[u],E[f]))!==l)return 1;if(function(r,t,e,n){var o;return o=t.x-r.x,t=t.y-r.y,r=n.x-e.x,n=n.y-e.y,o*r+t*n}(E[t],E[y],E[u],E[f])<h*er(E[u],E[f])*-.999847695156)return 1}p=R.c[3*K(t,S,s)+2].copy(),m=E[K(t+1,S,s)].copy(),_=E[K(e,S,s)].copy(),g=R.c[3*K(e,S,s)+2].copy(),r=a[e]-a[t],r-=rr(E[0],R.c[3*t+2],R.c[3*e+2])/2,e<=t&&(r+=a[S]);if(a=rr(p,m,_),w=rr(p,m,g),b=rr(p,_,g),A=a+b-w,w===a)return 1;if(a=w/(w-a),0==(w=w*(M=b/(b-A))/2))return 1;for(b=r/w,A=2-z.sqrt(4-b/.3),n.c[0]=Z(M*A,p,m),n.c[1]=Z(a*A,g,_),n.alpha=A,n.t=M,n.s=a,m=n.c[0].copy(),_=n.c[1].copy(),n.pen=0,c=K(t+1,S,s);c!=e;c=u){if(u=K(c+1,S,s),(M=mr(p,m,_,g,E[c],E[u]))<-.5)return 1;if(v=pr(M,p,m,_,g),0===(h=er(E[c],E[u])))return 1;if(x=rr(E[c],E[u],v)/h,z.abs(x)>o)return 1;if(xr(E[c],E[u],v)<0||xr(E[u],E[c],v)<0)return 1;n.pen+=x*x}for(c=t;c!=e;c=u){if(u=K(c+1,S,s),(M=mr(p,m,_,g,R.c[3*c+2],R.c[3*u+2]))<-.5)return 1;if(v=pr(M,p,m,_,g),0===(h=er(R.c[3*c+2],R.c[3*u+2])))return 1;if(x=rr(R.c[3*c+2],R.c[3*u+2],v)/h,d=rr(R.c[3*c+2],R.c[3*u+2],E[u])/h,(d*=.75*R.alpha[u])<0&&(x=-x,d=-d),x<d-o)return 1;x<d&&(n.pen+=(x-d)*(x-d))}return 0}(r,o,K(i,x,e),v,t,b,A,e);--o)(_[i]>_[o]+1||_[i]==_[o]+1&&m[i]>m[o]+v.pen)&&(p[i]=o,m[i]=m[o]+v.pen,_[i]=_[o]+1,g[i]=v,v=new H);for(n=_[x],f=new j(n),l=new Array(n),y=new Array(n),i=e?x:x-1,o=n-1;0<=o;--o)p[i]===i-1?(f.tag[o]=h.tag[K(i,x,e)],f.c[3*o+0]=h.c[3*K(i,x,e)+0],f.c[3*o+1]=h.c[3*K(i,x,e)+1],f.c[3*o+2]=h.c[3*K(i,x,e)+2],f.vertex[o]=h.vertex[K(i,x,e)],f.alpha[o]=h.alpha[K(i,x,e)],f.alpha0[o]=h.alpha0[K(i,x,e)],f.beta[o]=h.beta[K(i,x,e)],l[o]=y[o]=1):(f.tag[o]="CURVETO",f.c[3*o+0]=g[i].c[0],f.c[3*o+1]=g[i].c[1],f.c[3*o+2]=h.c[3*K(i,x,e)+2],f.vertex[o]=Z(g[i].s,h.c[3*K(i,x,e)+2],d[K(i,x,e)]),f.alpha[o]=g[i].alpha,f.alpha0[o]=g[i].alpha,l[o]=g[i].s,y[o]=g[i].t),i=p[i];for(o=0;o<n;++o)s=J(o+1,n),f.beta[o]=l[o]/(l[o]+y[s]);r.curve=f}(r,t.opttolerance,e)}(a,o,i);var l=a.curve;if(r.simplified_contours){for(var y=r.simplified_contours[t].borders[e].paths[n],h=(y.length=l.n-(i?0:1),y.segments=new Array(y.length+1),l.vertex),u=0,f=y.length;u<f;++u)y.segments[u]=h[u].copy();y.segments[y.length]=(i?y.segments[0]:c[c.length-1]).copy()}if(r.smoothed_contours){for(var x,d=r.smoothed_contours[t].borders[e].paths[n],p=(d.length=l.n-(i?0:1),d.segments=new Array(d.length+1),l.c),u=0,f=d.length;u<f;++u)"CORNER"===l.tag[u]?(x=u+1<l.n?u+1:0,d.segments[u]="CORNER"===l.tag[x]?new L(p[3*u+1].copy()):new L(p[3*u+1].copy(),p[3*u+2].copy())):d.segments[u]=new L(p[3*u+0].copy(),p[3*u+1].copy(),p[3*u+2].copy());d.segments[d.length]=i?d.segments[0]:new L(c[c.length-1].copy())}}}(o,l,h,p,i)}lr(o)}for(var _=r,g=(n.alphamax?r.smoothed_contours:r.simplified_contours)||r.raw_contours,v=n,w='<svg width="'+String(_.width)+'" height="'+String(_.height)+'" viewBox="0 0 '+String(_.width-1)+" "+String(_.height-1)+'" xmlns="http://www.w3.org/2000/svg">',b=_.components,A=_.component,M={bm:_,width:_.width,height:_.height,layered:v.layered,minpathsegments:v.minpathsegments,is_first_segment:!0,is_correct_order:!0,points:0,z:0},S=0;S<b;++S){var R=A[S].id,E=A[S].color;E&&(g?(M.thiscomponent=A[S],v.outline?w+=ir(g[R],R,M,"none",E,v.outline):w+=ir(g[R],R,M,E,E,.5)):v.outline?w+='\n<rect x="0" y="0" width="'+String(_.width)+'" height="'+String(_.height)+'" stroke="'+E+'" stroke-width="'+String(v.outline)+'"/>':w+='\n<rect x="0" y="0" width="'+String(_.width)+'" height="'+String(_.height)+'" fill="'+E+'"/>')}return w+="\n</svg>"},t="prototype",z=Math,C=Object[t].hasOwnProperty,k=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER,q[t]={constructor:q,id:0,root:null,xm:0,ym:0,xM:0,yM:0,area:0,cover:0,surround:null,color:0},I[t]={constructor:I,x:0,y:0,copy:function(){return new I(this.x,this.y)}},N=1,L[t]={constructor:L,control_points:null,is_vertex:function(){return!(e!==this.control_points[0].x&&isFinite(this.control_points[0].x)||e!==this.control_points[0].y&&isFinite(this.control_points[0].y))}},yr[t]={constructor:yr,len:0,sign:"",lon:null,lon:null,curve:null,pt:null,x0:0,y0:0,po:null,m:0,sums:null},j[t]={constructor:j,n:0,tag:null,c:null,alphaCurve:0,vertex:null,alpha:null,alpha0:null,beta:null},X[t]={constructor:X,data:null,at:function(r,t){return this.data[3*r+t]}},D[t]={constructor:D,x:0,y:0,xy:0,x2:0,y2:0},H[t]={constructor:H,pen:0,c:null,t:0,s:0,alpha:0};var O,t,z,C,k,e,N,i=O;function T(r,t,e){return z.min(z.max(r,t),e)}function q(r,t,e){var n=this;n.id=-1,n.xm=n.xM=r,n.ym=n.yM=t,n.area=0,n.cover=0,n.color=0,n.root=e||n}function I(r,t){this.x=r,this.y=t}function V(r,t){return!(!r||!t)&&r.x===t.x&&r.y===t.y}function nr(r,t,e){r&&(r.xm=z.min(r.xm,t),r.xM=z.max(r.xM,t),r.ym=z.min(r.ym,e),r.yM=z.max(r.yM,e))}function F(r,t,e){var n,o,i=0,a=r.length-1;if(a<i)return e||r.push(t),-1;if(i===a)return o=r[0],t.id===o.id?0:(e||r[t.id>o.id?"push":"unshift"](t),-1);for(;;){if(o=r[n=i+a>>>1],t.id===o.id)return n;if(i===n)return e||r.splice(t.id<o.id?n:1+n,0,t),-1;t.id<o.id?a=n:i=n}}function or(r){for(var t,e,n,o,i,a=r.length,s=new Array(a),c=0;c<a;++c)for(t=r[c],s[c]=e={number_of_borders:t.number_of_borders,borders:new Array(t.number_of_borders)},o=0,i=t.number_of_borders;o<i;++o)n=t.borders[o],e.borders[o]={number_of_paths:n.number_of_paths,paths:n.paths.map(function(r){return{length:0,segments:null,other_comp:r.other_comp,others:r.others}})};return s}function n(){return new I(e,e)}function L(r,t,e){this.control_points=1===arguments.length?[n(),r,n()]:2===arguments.length?[n(),r,t]:[r,t,e]}function u(r,t){return++t.points,String(r.x.toFixed(2))+" "+String((t.height-1-r.y).toFixed(2))}function f(r,t){var e="";return r instanceof L?r.is_vertex()?(t.is_correct_order&&(e+=f(r.control_points[1],t)),r.control_points[2]&&!V(r.control_points[2],n())&&(e+=f(r.control_points[2],t)),t.is_correct_order||(e+=f(r.control_points[1],t))):t.is_correct_order?t.is_first_segment?e+=f(r.control_points[2],t):e=(e=(e=(e+="C")+u(r.control_points[0],t)+",")+u(r.control_points[1],t)+",")+u(r.control_points[2],t):(e=(e=(e=e+u(r.control_points[2],t)+"C")+u(r.control_points[1],t)+",")+u(r.control_points[0],t)+",",t.is_first_segment=!1):(t.is_correct_order&&!t.is_first_segment&&(e+="L"),e+=u(r,t),t.is_correct_order||(e+="L"),t.is_first_segment=!1),e}function ir(r,t,e,n,o,i){for(var a="",s=e.points=0,c=r.number_of_borders;s<c;++s)a+=function(r,t,e){var n,o,i,a="";e.is_first_segment=!0;for(var s=0,c=r.number_of_paths;s<c;++s)n=r.paths[c-1-s],e.layered&&function(r,t,e){var n;return!(r.other_comp>=e.components||(n=e.component[r.other_comp]).id===t.id||!n.color)&&function r(t,e,n){if(!(e.xm<t.xm&&t.xM<e.xM&&e.ym<t.ym&&t.yM<e.yM))return!1;F(n=n||[],t);for(var o,i=t.surround,a=0,s=i.length;a<s;++a)if((o=i[a]).id!==e.id&&-1===F(n,o,!0)&&!r(o,e,n))return!1;return!0}(n,t)}(n,e.thiscomponent,e.bm)||(i=e.is_correct_order,e.is_correct_order=t>n.other_comp,a+=function(r,t,e){var n="";t.is_first_segment?n+="M":e&&!t.is_correct_order?n+="L":!e&&t.is_correct_order&&(t.is_first_segment=!0);for(var o=0,i=r.length;o<i;++o)n+=f(t.is_correct_order?r.segments[o]:r.segments[i-o],t);return n}(n,e,i),o=n);o&&(a=function(r,t,e,n){return n.z=0,t instanceof L?(t.is_vertex()?e.is_vertex()?n.is_correct_order||(r=r.slice(0,-1)):n.is_correct_order?r+=f(e,n):(r+="z",n.z=1,++n.points):n.is_correct_order?e.is_vertex()||(r+=f(e,n)):r+=u(e.control_points[2],n),e.is_vertex()&&(r+="z",n.z=1,++n.points)):(n.is_correct_order||(r=r.slice(0,-1)),r+="z",n.z=1,++n.points),r}(a,(n=o).segments[e.is_correct_order?n.length-1:1],n.segments[e.is_correct_order?n.length:0],e));return a}(r.borders[s],t,e);return e.points<1+e.minpathsegments?"":(a='\n<path d="'+a+'" fill="'+(n||"#000")+'" fill-rule="nonzero"')+(i&&0<i?' stroke="'+(o||"#000")+'" stroke-width="'+String(i)+'"':' stroke="none"')+"/>"}function U(r,t,e){return t+(r.height-1-e)*r.width}function B(r,t){return t+r.width-1}function G(r,t){return t+r.width}function ar(r,t){return t-=r.width}function sr(r,t){return t+=1}function P(r){return 0===r?3:3===r?N:r===N?2:0}function cr(r){return 0===r?2:2===r?N:r===N?3:0}function o(r,t){return 0<=t.x&&0<=t.y&&t.x<r.width&&t.y<r.height}function $(r,t,e){return 0===e?o(r,t)&&0<t.x:e===N?o(r,t)&&0<t.y:2===e?o(r,t)&&0<t.y&&0<t.x:o(r,t)}function ur(r,t,e){return 0===e?t-1:e===N?G(r,t):2===e?B(r,t):t}function c(r,t,e){return(r.border_statuses[ur(r,t,e)]||0)&1<<e}function fr(r,t,e){for(var n=r.bboxes[t],o=n.lower_left.x,i=n.upper_right.x,a=n.upper_right.y;e.y<a;++e.y){for(var s=U(r,e.x,e.y);e.x<i;++e.x){if(r.data[s].id===t){if((e.y<=0||r.data[G(r,s)].id!==t)&&$(r,e,3)&&!c(r,s,3))return 3}else if(0<e.x&&0<e.y&&r.data[s-1].id===t&&$(r,e,0)&&!c(r,s,0))return 0;s=sr(0,s)}e.x=o}return N}function lr(r){for(var t=0,e=r.components,n=0;n<e;++n)for(var o=r.raw_contours[n],i=0,a=o.number_of_borders;i<a;++i)for(var s=o.borders[i],c=0,u=s.number_of_paths;c<u;++c){var t=0,f=s.paths[c];if(!(n<f.other_comp)){for(var l=r.raw_contours[f.other_comp],y=0,h=l.number_of_borders;y<h;++y){for(var x=l.borders[y],d=0,p=x.number_of_paths;d<p;++d){var m,_=x.paths[d];if(_.other_comp===n){if(V(f.segments[0],_.segments[_.segments.length-1])&&V(f.segments[1],_.segments[_.segments.length-2])){f.length=_.length,f.segments=_.segments,_.others&&(f.others=_.others.filter(function(r){return r.id!==n&&r.id!==f.other_comp}).concat([r.component[f.other_comp]])),r.simplified_contours&&(_=r.simplified_contours[n].borders[i].paths[c],m=r.simplified_contours[f.other_comp].borders[y].paths[d],_.length=m.length,_.segments=m.segments,_.others=f.others),r.smoothed_contours&&(m=r.smoothed_contours[n].borders[i].paths[c],_=r.smoothed_contours[f.other_comp].borders[y].paths[d],m.length=_.length,m.segments=_.segments,m.others=f.others),t=1;break}if(t)break}}if(t)break}if(!t)return}}}function yr(){this.len=0}function j(r){var t=this;t.n=r,t.tag=new Array(r),t.c=new Array(3*r),t.alphaCurve=0,t.vertex=new Array(r),t.alpha=new Array(r),t.alpha0=new Array(r),t.beta=new Array(r)}function X(){this.data=[0,0,0,0,0,0,0,0,0]}function D(r,t,e,n,o){var i=this;i.x=r,i.y=t,i.xy=e,i.x2=n,i.y2=o}function H(){var r=this;r.pen=0,r.c=[new I(0,0),new I(0,0)],r.t=0,r.s=0,r.alpha=0}function J(r,t){return t<=r?r%t:0<=r?r:t-1-(-1-r)%t}function K(r,t,e){return e?J(r,t):r}function Q(r,t){return r.x*t.y-r.y*t.x}function hr(r,t,e){return r<=e?r<=t&&t<e:r<=t||t<e}function W(r){return 0<r?1:r<0?-1:0}function Y(r,t){for(var e,n=[t.x,t.y,1],o=0,i=0;i<3;++i)for(e=0;e<3;++e)o+=n[i]*r.at(i,e)*n[e];return o}function Z(r,t,e){return new I(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y))}function rr(r,t,e){var n=t.x-r.x,t=t.y-r.y,o=e.x-r.x;return n*(e.y-r.y)-o*t}function tr(r,t,e,n){var o=t.x-r.x,t=t.y-r.y,r=n.x-e.x;return o*(n.y-e.y)-r*t}function xr(r,t,e){var n=t.x-r.x,t=t.y-r.y;return n*(e.x-r.x)+t*(e.y-r.y)}function dr(r,t){r=z.abs(r),t=z.abs(t);var e=z.max(r,t);return 0===e?0:e*z.sqrt((r/=e)*r+(t/=e)*t)}function er(r,t){return dr(r.x-t.x,r.y-t.y)}function pr(r,t,e,n,o){var i=1-r,a=r*r,s=i*i,c=s*i,u=a*r,s=3*s*r,r=3*a*i;return new I(c*t.x+s*e.x+r*n.x+u*o.x,c*t.y+s*e.y+r*n.y+u*o.y)}function mr(r,t,e,n,o,i){var r=tr(r,t,o,i),t=tr(t,e,o,i),e=r-2*t+tr(e,n,o,i),n=-2*r+2*t,o=n*n-4*e*r;return 0===e||o<0?-1:(t=(-n-(i=z.sqrt(o)))/(2*e),0<=(r=(-n+i)/(2*e))&&r<=1?r:0<=t&&t<=1?t:-1)}return r.potrace=i,r});